<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { font-family: Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; }
    .form-container { background-color: #ffffff; padding: 30px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 900px; overflow-y: auto; }
    h1 { font-size: 24px; color: #333; text-align: center; margin-bottom: 20px; }
    .form-group { margin-bottom: 15px; }
    label { font-size: 12px; color: #555; display: block; margin-bottom: 5px; font-weight: bold; }
    input, select, input[type="file"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 7px; font-size: 14px; text-transform: uppercase; background-color: #f0f0f0; box-sizing: border-box; }
    select { background-color: #f0f0f0; }
    input:focus, select:focus { outline: none; border-color: #555555; }
    .form-button { background-color: #85B5D9; color: white; padding: 12px 20px; font-size: 16px; border: none; border-radius: 20px; cursor: pointer; width: 100%; margin-top: 10px; }
    .form-button:hover { background-color: #0275C5; }
    .logo-container { text-align: center; margin-bottom: 20px; width: auto; height: auto; }
    .logo-container img { width: auto; height: auto; max-width: 100%; }
    .form-group input.filled, .form-group select.filled { background-color: #e1f0ff; }
    /* ... seus outros estilos ... */
    .form-group-row { display: flex; gap: 10px; align-items: flex-end; margin-bottom: 20px; }
    .form-group-row .form-group { margin-bottom: 0; }
    .form-group-row .form-group:nth-child(1) { flex: 2; }
    .form-group-row .form-group:nth-child(2) { flex: 1; }
    .form-group-row .form-group:nth-child(3) { flex: 1; }
    .form-group-row .form-group:nth-child(4) { flex: 3; }
    .form-group-row .form-group:nth-child(5) { flex: 1; }
</style>
</head>
<body>
    <div class="form-container">
        <div class="logo-container">
            <img src="imagem.png" alt="Logo">
        </div>
        <h1>SOLICITAÇÃO DE DEMANDAS</h1>
        <form id="contact-form">
            <div class="form-group-row">
                <div class="form-group" style="flex: 4;">
                    <label for="solicitante">SOLICITANTE</label>
                    <input type="text" id="solicitante" name="solicitante" oninput="maiusculas(this); markAsFilled(this)" required autocomplete="off">
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 2">
                    <div class="form-group" style="flex: 3;">
                        <label for="unidade">UNIDADE</label>
                        <select id="unidade" name="unidade" required onchange="markAsFilled(this)" autocomplete="off">
                            <option value=""></option>
                            <option value="FACULDADE DE ENGENHARIA DE BAURU">FACULDADE DE ENGENHARIA DE BAURU</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" style="flex: 3;">
                    <label for="area">ÁREA</label>
                    <select id="area" name="area" required onchange="markAsFilled(this)">
                        <option value=""></option>
                        <option value="COLÉGIO TÉCNICO INDUSTRIAL">COLÉGIO TÉCNICO INDUSTRIAL</option>
                        <option value="DIRETORIA">DIRETORIA</option>
                        <option value="DIVISÃO TÉCNICA ACADÊMICA">DIVISÃO TÉCNICA ACADÊMICA</option>
                        <option value="DIVISÃO TÉCNICA ADMINISTRATIVA">DIVISÃO TÉCNICA ADMINISTRATIVA</option>
                        <option value="DIRETORIA TÉCNICA DE INFORMÁTICA">DIRETORIA TÉCNICA DE INFORMÁTICA</option>
                        <option value="SEÇÃO DE APOIO ADMINISTRATIVO">SEÇÃO DE APOIO ADMINISTRATIVO</option>
                        <option value="SEÇÃO TÉCNICA DE APOIO AO ENSINO, PESQUISA E EXTENSÃO">SEÇÃO TÉCNICA DE APOIO AO ENSINO, PESQUISA E EXTENSÃO</option>
                        <option value="SEÇÃO TÉCNICA DE DE GRADUAÇÃO">SEÇÃO TÉCNICA DE DE GRADUAÇÃO</option>
                        <option value="SEÇÃO TÉCNICA DE DE PÓS-GRADUAÇÃO">SEÇÃO TÉCNICA DE DE PÓS-GRADUAÇÃO</option>
                        <option value="SEÇÃO TÉCNICA DE FINANÇAS">SEÇÃO TÉCNICA DE FINANÇAS</option>
                        <option value="SEÇÃO TÉCNICA DE GESTÃO DE PESSOAS">SEÇÃO TÉCNICA DE GESTÃO DE PESSOAS</option>
                        <option value="SEÇÃO TÉCNICA DE MATERIAIS">SEÇÃO TÉCNICA DE MATERIAIS</option>
                        <option value="VICE-DIRETORIA">VICE-DIRETORIA</option>
                    </select>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 2;">
                    <label for="telefone">TELEFONE</label>
                    <input type="text" id="telefone" name="telefone" oninput="markAsFilled(this)" maxlength="14" required autocomplete="off">
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="celular">CELULAR</label>
                    <input type="text" id="celular" name="celular" oninput="markAsFilled(this)" maxlength="15" required autocomplete="off">
                </div>
                <div class="form-group" style="flex: 3;">
                    <label for="email">E-MAIL</label>
                    <input type="email" id="email" name="email" required autocomplete="off" oninput="maiusculas(this); markAsFilled(this)">
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 2;">
                    <label for="classificacao">CLASSIFICAÇÃO</label>
                    <select id="classificacao" name="classificacao" required onchange="markAsFilled(this)" autocomplete="off">
                        <option value=""></option>
                        <option value="SERVIÇOS">INSTALAÇÃO</option>
                        <option value="ACADEMICA">PEQUENA AMPLIAÇÃO</option>
                        <option value="ADMINISTRATIVA">PEQUENO REPARO</option>
                        <option value="ACADEMICA">REMOÇÃO</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 3;">
                    <label for="tipoServico">TIPO DE SERVIÇO</label>
                    <select id="tipoServico" name="tipoServico" required onchange="markAsFilled(this)" autocomplete="off">
                        <option value=""></option>
                        <option value="ACADEMICA">AR CONDICIONADO</option>
                        <option value="SERVIÇOS">CABEAMENTO ESTRUTURAL</option>
                        <option value="SERVIÇOS">DIVISÓRIAS</option>
                        <option value="ACADEMICA">FORROS</option>
                        <option value="ACADEMICA">HIDRÁULICA</option>
                        <option value="ADMINISTRATIVA">JANELAS</option>
                        <option value="ADMINISTRATIVA">PINTURA</option>
                        <option value="ACADEMICA">PISO</option>
                        <option value="ACADEMICA">PORTAS</option>
                        <option value="SERVIÇOS">RUFOS E CALHAS</option>
                        <option value="ACADEMICA">SISTEMA DE ALARME</option>
                        <option value="ADMINISTRATIVA">SISTEMA DE VIGILÂNCIA</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="m2">TAMANHO (ÁREA - M2)</label>
                    <input type="text" id="m2" name="m2" oninput="maiusculas(this); markAsFilled(this)" autocomplete="off">
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 2;">
                    <label for="previsaoCusto">PREVISÃO DE CUSTO</label>
                    <input type="text" id="previsaoCusto" name="previsaoCusto" oninput="maiusculas(this); markAsFilled(this)" autocomplete="off">
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="origemVerba">ORIGEM DA VERBA</label>
                    <select id="origemVerba" name="origemVerba" required onchange="markAsFilled(this)" autocomplete="off">
                        <option value=""></option>
                        <option value="DIRETORIA">DIRETORIA</option>
                        <option value="DEPARTAMENTO">DEPARTAMENTO</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="pca">PREVISTA NO PCA</label>
                    <select id="pca" name="pca" required onchange="markAsFilled(this)" autocomplete="off">
                        <option value=""></option>
                        <option value="SERVIÇOS">SIM</option>
                        <option value="ACADEMICA">NÃO</option>
                    </select>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 4;">
                    <label for="justificativa">JUSTIFICATIVA</label>
                    <input type="text" id="justificativa" name="justificativa" oninput="maiusculas(this); markAsFilled(this)" required autocomplete="off">
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group" style="flex: 2;">
                    <label for="imagemLocal">IMAGEM DO LOCAL</label>
                    <input type="file" id="imagemLocal" name="imagemLocal" accept="application/pdf" onchange="markAsFilled(this)" >
                </div>
                <div class="form-group" style="flex: 2;">
                    <label for="esbocoProjeto">ESBOÇO DO PROJETO</label>
                    <input type="file" id="esbocoProjeto" name="esbocoProjeto" accept="application/pdf" onchange="markAsFilled(this)" >
                </div>
            </div>
            <button type="submit" class="form-button">Enviar</button>
        </form>
    </div>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbx_EdaQTWzQ0N43K8CBXnZxk3X1ZFugHgZ5RtnN2pA8LJVRU-kU2ANr_AgK47PqbvbceQ/exec";
const form = document.forms["contact-form"];

// Máscaras telefone/celular
document.getElementById("telefone").addEventListener("input", function(event) {
    let valor = event.target.value.replace(/\D/g, "");
    valor = (valor.length <= 9) ? valor.replace(/(\d{2})(\d{0,4})(\d{0,4})/, "($1) $2-$3") : valor.replace(/(\d{2})(\d{4})(\d{0,4})/, "($1) $2-$3");
    event.target.value = valor;
});
document.getElementById("celular").addEventListener("input", function(event) {
    let valor = event.target.value.replace(/\D/g, "");
    valor = (valor.length <= 10) ? valor.replace(/(\d{2})(\d{0,5})(\d{0,4})/, "($1) $2-$3") : valor.replace(/(\d{2})(\d{5})(\d{0,4})/, "($1) $2-$3");
    event.target.value = valor;
});

// Formular em maiúsculas
function maiusculas(input) { input.value = input.value.toUpperCase(); }
function markAsFilled(input) {
    if (input.value.trim() !== "") { input.classList.add("filled");
    } else { input.classList.remove("filled"); }
}

form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    // Função para ler arquivos como Base64
    async function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(",")[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // Validar os arquivos antes de enviar
    const fileInputs = ["imagemLocal", "esbocoProjeto"];
    let hasInvalidFile = false;
    fileInputs.forEach(inputId => {
        const file = document.getElementById(inputId).files[0];
        if (file && file.type !== "application/pdf") {
            alert(`O arquivo em ${inputId} deve ser um PDF.`);
            hasInvalidFile = true;
        }
    });
    if (hasInvalidFile) return;

    try {
        // Ler os arquivos PDF como Base64
        const imagemLocalBase64 = document.getElementById("imagemLocal").files[0] ? await readFileAsBase64(document.getElementById("imagemLocal").files[0]) : null;
        const esbocoProjetoBase64 = document.getElementById("esbocoProjeto").files[0] ? await readFileAsBase64(document.getElementById("esbocoProjeto").files[0]) : null;

        // Converter FormData para objeto e tratar os dados
        const dados = Object.fromEntries(formData.entries());
        Object.keys(dados).forEach(key => {
            if (typeof dados[key] === 'string') {
                if (/^\d{4}-\d{2}-\d{2}$/.test(dados[key])) {
                    const [ano, mes, dia] = dados[key].split('-');
                    dados[key] = `${dia.padStart(2, '0')}/${mes.padStart(2, '0')}/${ano}`;
                } else {
                    dados[key] = dados[key].toUpperCase();
                }
            }
        });

        const data = {
            ...dados,
            imagemLocal: imagemLocalBase64,
            esbocoProjeto: esbocoProjetoBase64,
        };

        const submitButton = document.querySelector("button[type='submit']");
        submitButton.disabled = true;
        submitButton.innerText = "Enviando formulário. Aguarde...";

        await fetch(scriptURL, {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" },
            mode: "no-cors",
        });

        // --- LIMPEZA COMPLETA AQUI ---
        form.reset();
        // Remove classe 'filled' de todos inputs/selects/textareas
        form.querySelectorAll('input, select, textarea').forEach(el => el.classList.remove('filled'));
        // Garante que campos file também fiquem limpos visualmente (redundante, mas seguro)
        form.querySelectorAll('input[type="file"]').forEach(input => input.value = '');

    } catch (error) {
        alert("Erro: " + error.message);
        console.error("Erro detalhado:", error);
    } finally {
        const submitButton = document.querySelector("button[type='submit']");
        submitButton.disabled = false;
        submitButton.innerText = "Enviar";
    }
});
</script>
</body>
</html>